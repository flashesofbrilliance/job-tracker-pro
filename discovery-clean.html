<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset=20250920212628"UTF-8" />
  <meta name="viewport" content=20250920212628"width=device-width, initial-scale=1.0" />
  <title>Discovery Engine</title>
  
  <!-- CRITICAL: DNS Prefetch for faster CDN connections -->
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
  
  <!-- CRITICAL: Preconnect to external resources -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  
  <!-- CRITICAL CSS: Inline above-the-fold styles for instant rendering -->
  <style>
    /* Critical path CSS - inline for immediate render */
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; background: #1a1a2e; color: #fff; }
    .app-container { min-height: 100vh; }
    .loading-screen { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: #1a1a2e; z-index: 9999; }
    .loading-spinner { width: 50px; height: 50px; border: 3px solid #333; border-top: 3px solid #21808d; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
  
  <!-- OPTIMIZED: Non-blocking CSS load with media attribute trick -->
  <link rel="preload" href="style.css?v=0.1.0&t=20250920212628" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="style.css?v=0.1.0&t=20250920212628"></noscript>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content=20250920212628"#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content=20250920212628"yes">
  <meta name="apple-mobile-web-app-status-bar-style" content=20250920212628"black-translucent">
  <meta name="apple-mobile-web-app-title" content=20250920212628"Sushi Discovery">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  
  <!-- Mobile Optimizations -->
  <meta name="viewport" content=20250920212628"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=20250920212628cover">
  <meta name="mobile-web-app-capable" content=20250920212628"yes">
  <meta name="format-detection" content=20250920212628"telephone=no">
</head>
<body>
  <!-- Loading Screen for better perceived performance -->
  <div class="loading-screen" id="loading-screen">
    <div class="loading-spinner"></div>
  </div>

  <div class="app-container">
    <header class="app-header">
      <div class="header-content">
        <div class="header-left">
          <h1 class="app-title"><i class="fas fa-compass"></i> Discovery Engine</h1>
        </div>
        <div class="header-actions">
          <button class="btn btn--outline btn--sm" id="refresh-btn"><i class="fas fa-sync"></i> Refresh</button>
          <a class="btn btn--secondary btn--sm" href="index.html"><i class="fas fa-home"></i> Back to App</a>
        </div>
      </div>
    </header>

    <main class="sushi-discovery-main">
      <!-- Job Info Display -->
      <section class="job-info-section">
        <div class="job-display-container">
          <div class="job-card" id="job-card">
            <div class="card-primary">
              <div class="company-section">
                <h1 class="company-name" id="card-company">Loading...</h1>
                <div class="company-context">
                  <span class="sector" id="sector-value">--</span>
                  <span class="separator">‚Ä¢</span>
                  <span class="location" id="location-value">--</span>
                </div>
              </div>
              
              <div class="role-section">
                <h2 class="role-title" id="card-role">Preparing...</h2>
                <div class="salary-range" id="salary-value">$--</div>
              </div>
              
              <div class="fit-indicator">
                <div class="fit-score-container">
                  <div class="fit-score" id="fit-score-value">--</div>
                  <div class="fit-label">Match</div>
                </div>
                <div class="fit-bar">
                  <div class="fit-fill" id="fit-bar-fill"></div>
                </div>
              </div>
            </div>
            
            <div class="card-secondary">
              <div class="skills-tags" id="card-tags"></div>
              <div class="decision-helpers">
                <div class="quick-stats">
                  <div class="stat-item">
                    <span class="stat-icon">‚ö°</span>
                    <span class="stat-text" id="quick-apply">Quick Apply</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-icon">üéØ</span>
                    <span class="stat-text" id="competition-level">Medium Competition</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="action-bar">
              <button class="action-btn reject-btn" id="reject-btn">
                <span class="btn-icon">üëé</span>
                <span class="btn-text">Pass</span>
                <span class="btn-key">‚Üê</span>
              </button>
              
              <button class="action-btn next-btn" id="next-btn">
                <span class="btn-icon">‚è≠Ô∏è</span>
                <span class="btn-text">Next</span>
                <span class="btn-key">Space</span>
              </button>
              
              <button class="action-btn accept-btn" id="accept-btn">
                <span class="btn-icon">üëç</span>
                <span class="btn-text">Apply</span>
                <span class="btn-key">‚Üí</span>
              </button>
            </div>
          </div>
        </div>
      </section>
      
      <!-- 3D Sushi Diorama Scene - Lazy loaded -->
      <section class="sushi-diorama-section">
        <canvas id="sushi-3d-canvas" style="width: 100%; height: 400px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);"></canvas>
      </section>
    </main>
    
    <!-- Analytics Section -->
    <footer class="analytics-footer collapsed">
      <div class="analytics-toggle" onclick="toggleAnalytics()">
        <i class="fas fa-chart-line"></i>
        <span>Analytics</span>
        <i class="fas fa-chevron-up"></i>
      </div>
      <div class="analytics-content" id="analytics-content">
        <div class="analytics-grid">
          <div class="analytics-card">
            <h4>Learning Signals</h4>
            <div id="signals"></div>
          </div>
          <div class="analytics-card">
            <h4>Belt Analytics</h4>
            <div id="belt-analytics"></div>
          </div>
        </div>
      </div>
    </footer>

    <div class="toast-container" id="toast-container"></div>
  </div>

  <!-- OPTIMIZED JAVASCRIPT LOADING SEQUENCE -->
  
  <!-- Phase 1: Critical Dependencies (blocking) -->
  <script>
    // Immediate performance optimization
    window.performance && performance.mark && performance.mark('app-start');
    
    // Critical polyfills and feature detection
    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = function(cb) { return setTimeout(cb, 16); };
    }
    
    // GPU capability detection for optimal rendering path
    window.GPU_CAPABLE = (function() {
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl2') || canvas.getContext('webgl');
      return !!(gl && gl.getParameter && gl.getParameter(gl.VERSION));
    })();
    
    console.log('üöÄ Hardware capability detected:', { GPU: window.GPU_CAPABLE });
  </script>
  
  <!-- Phase 2: Essential Libraries (Only Three.js - removed unused GSAP, Cannon.js, Tween.js) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" defer></script>
  
  <!-- Phase 3: Core Application Modules (medium priority) -->
  <script src="performance-manager.js?v=clean&t=20250920212628" defer></script>
  <script src="discovery-core.js?v=clean&t=20250920212628" defer></script>
  
  <!-- Phase 4: Cache Management (New addition) -->
  <script src="conveyor-cache-manager.js?v=clean&t=20250920212628" defer></script>
  
  <!-- Phase 5: 3D Scene Components (lazy loaded after critical path) -->
  <script>
    // Lazy load 3D components after critical rendering
    function loadEnhancedComponents() {
      const scripts = [
        'sushi-scene-manager.js?v=clean&t=20250920212628',
        'woodblock-patterns.js?v=clean&t=20250920212628'
      ];
      
      scripts.forEach((src, index) => {
        const script = document.createElement('script');
        script.src = src;
        script.defer = true;
        if (index === scripts.length - 1) {
          script.onload = initialize3DScene;
        }
        document.head.appendChild(script);
      });
    }
    
    // Initialize 3D scene after all dependencies load
    function initialize3DScene() {
      if (window.SushiSceneManager && window.GPU_CAPABLE) {
        console.log('üèÆ Initializing 3D scene...');
        const canvas = document.getElementById('sushi-3d-canvas');
        if (canvas) {
          window.sushiScene = new SushiSceneManager(canvas);
        }
      }
    }
    
    // Load non-critical components after page is interactive
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(loadEnhancedComponents, 100);
      });
    } else {
      setTimeout(loadEnhancedComponents, 100);
    }
  </script>
  
  <!-- Phase 6: Main Application Logic -->
  <script src="discovery.js?v=clean&t=20250920212628" defer></script>
  
  <!-- Phase 7: Application Initialization -->
  <script>
    // Initialize core application
    function initializeApp() {
      // Hide loading screen
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        loadingScreen.style.opacity = '0';
        setTimeout(() => loadingScreen.remove(), 300);
      }
      
      // Initialize cache manager for smooth conveyor belt
      if (window.ConveyorCacheManager) {
        window.cacheManager = new ConveyorCacheManager({
          bufferSize: 5,
          prefetchSize: 3,
          maxCacheSize: 20
        });
        
        // Load initial job set
        const jobIds = Array.from({length: 100}, (_, i) => `job-${i + 1}`);
        window.cacheManager.loadInitialJobs(jobIds);
      }
      
      // Initialize performance manager with hardware optimization
      if (window.MobilePerformanceManager) {
        window.performanceManager = new MobilePerformanceManager();
      }
      
      // Performance mark
      if (window.performance && performance.mark) {
        performance.mark('app-ready');
        performance.measure('app-startup', 'app-start', 'app-ready');
      }
      
      console.log('üç£ Sushi Discovery Engine ready!');
    }
    
    // Analytics toggle function
    function toggleAnalytics() {
      const footer = document.querySelector('.analytics-footer');
      const chevron = document.querySelector('.analytics-toggle .fa-chevron-up');
      
      if (footer) footer.classList.toggle('collapsed');
      if (chevron) {
        chevron.className = footer?.classList.contains('collapsed') 
          ? 'fas fa-chevron-up' 
          : 'fas fa-chevron-down';
      }
    }
    
    window.toggleAnalytics = toggleAnalytics;
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
  
  <!-- Service Worker Registration (non-blocking) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js').catch(function(error) {
          console.log('SW registration failed');
        });
      });
    }
  </script>
</body>
</html>