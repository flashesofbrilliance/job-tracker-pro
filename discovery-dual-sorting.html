<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üç£ Dual Sorting Sushi Factory</title>
  
  <style>
    /* Factory Layout Aesthetic */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      margin: 0;
      font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
      background: linear-gradient(135deg, #1a2332 0%, #2d3e50 25%, #34495e 50%, #2d3e50 75%, #1a2332 100%);
      background-size: 400% 400%;
      animation: factoryHum 30s ease infinite;
      color: #ecf0f1;
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }
    
    @keyframes factoryHum {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    /* Header Bar - Position: (75, 137), Size: 800 x 60 */
    .header-bar {
      position: absolute;
      left: 75px;
      top: 137px;
      width: 800px;
      height: 60px;
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      border: 2px solid #3498db;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
    }
    
    .header-title {
      font-size: 1.8rem;
      font-weight: 300;
      color: #ecf0f1;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
    }
    
    .header-stats {
      display: flex;
      gap: 20px;
      font-size: 0.9rem;
    }
    
    .stat-badge {
      background: rgba(52, 152, 219, 0.1);
      padding: 6px 12px;
      border-radius: 4px;
      border: 1px solid rgba(52, 152, 219, 0.3);
    }
    
    /* Conveyor Belt - Position: (362, 245), Size: 200 x 400 */
    .conveyor-belt {
      position: absolute;
      left: 362px;
      top: 245px;
      width: 200px;
      height: 400px;
      background: linear-gradient(180deg, #34495e 0%, #2c3e50 50%, #34495e 100%);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 
        inset 0 0 20px rgba(0, 0, 0, 0.3),
        0 8px 32px rgba(0, 0, 0, 0.4);
      border: 3px solid #4a6174;
    }
    
    .belt-container {
      width: 120px;
      height: 100%;
      margin: 0 auto;
      position: relative;
      background: linear-gradient(90deg, #555 0%, #666 50%, #555 100%);
      box-shadow: inset 6px 0 12px rgba(0, 0, 0, 0.4);
    }
    
    .belt-track {
      width: 80px;
      height: 100%;
      margin: 0 auto;
      background: repeating-linear-gradient(
        0deg,
        #666 0px,
        #666 12px,
        #555 12px,
        #555 24px
      );
      animation: beltMove 3s linear infinite;
      position: relative;
    }
    
    @keyframes beltMove {
      0% { background-position: 0px 0px; }
      100% { background-position: 0px 24px; }
    }
    
    /* Sushi Items */
    .sushi-item {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2.8rem;
      cursor: grab;
      user-select: none;
      z-index: 100;
      transition: all 0.2s ease;
      animation: sushiFlow 6s linear infinite;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }
    
    .sushi-item:hover {
      transform: translateX(-50%) scale(1.15);
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
    }
    
    .sushi-item:active {
      cursor: grabbing;
    }
    
    .sushi-item.dragging {
      z-index: 1000;
      transform: translateX(-50%) rotate(15deg) scale(1.3);
      opacity: 0.9;
    }
    
    @keyframes sushiFlow {
      0% { top: -8%; opacity: 0; }
      5% { opacity: 1; }
      95% { opacity: 1; }
      100% { top: 108%; opacity: 0; }
    }
    
    /* Left Text Block - Position: (145, 244), Size: 200 x 40 */
    .left-label {
      position: absolute;
      left: 145px;
      top: 244px;
      width: 200px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      font-weight: 600;
      color: #e74c3c;
      background: rgba(231, 76, 60, 0.1);
      border: 2px solid rgba(231, 76, 60, 0.3);
      border-radius: 6px;
    }
    
    /* Right Text Block - Position: (577, 245), Size: 200 x 40 */
    .right-label {
      position: absolute;
      left: 577px;
      top: 245px;
      width: 200px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      font-weight: 600;
      color: #27ae60;
      background: rgba(39, 174, 96, 0.1);
      border: 2px solid rgba(39, 174, 96, 0.3);
      border-radius: 6px;
    }
    
    /* Left Sorting Bins - Position: (144, 288), Size: 201 x 355 */
    .left-sorting-bins {
      position: absolute;
      left: 144px;
      top: 288px;
      width: 201px;
      height: 355px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    /* Right Sorting Bins - Position: (577, 289), Size: 200 x 353 */
    .right-sorting-bins {
      position: absolute;
      left: 577px;
      top: 289px;
      width: 200px;
      height: 353px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .sorting-bin {
      flex: 1;
      border-radius: 12px;
      border: 3px dashed rgba(255, 255, 255, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      transition: all 0.3s ease;
      background: rgba(0, 0, 0, 0.2);
      position: relative;
      min-height: 160px;
    }
    
    .sorting-bin.reject-bin {
      color: rgba(231, 76, 60, 0.8);
      border-color: rgba(231, 76, 60, 0.5);
    }
    
    .sorting-bin.accept-bin {
      color: rgba(39, 174, 96, 0.8);
      border-color: rgba(39, 174, 96, 0.5);
    }
    
    .sorting-bin.drag-over {
      border-style: solid;
      transform: scale(1.02);
      background: rgba(255, 255, 255, 0.1);
    }
    
    .sorting-bin.reject-bin.drag-over {
      background: rgba(231, 76, 60, 0.15);
      box-shadow: 0 0 30px rgba(231, 76, 60, 0.4);
      color: #e74c3c;
    }
    
    .sorting-bin.accept-bin.drag-over {
      background: rgba(39, 174, 96, 0.15);
      box-shadow: 0 0 30px rgba(39, 174, 96, 0.4);
      color: #27ae60;
    }
    
    .bin-icon {
      font-size: 2.5rem;
      margin-bottom: 8px;
    }
    
    .bin-label {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .bin-subtitle {
      font-size: 0.8rem;
      opacity: 0.7;
    }
    
    .bin-count {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    /* Controls - Position: (144, 654), Size: 150 x 100 */
    .controls-panel {
      position: absolute;
      left: 144px;
      top: 654px;
      width: 150px;
      height: 100px;
      background: rgba(44, 62, 80, 0.8);
      border-radius: 8px;
      padding: 12px;
      border: 2px solid #4a6174;
    }
    
    .controls-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #3498db;
    }
    
    .speed-slider {
      width: 100%;
      margin: 8px 0;
      accent-color: #3498db;
    }
    
    .speed-display {
      font-size: 0.75rem;
      text-align: center;
      color: #bdc3c7;
    }
    
    /* Job Queue - Position: (306, 656), Size: 322 x 99 */
    .job-queue {
      position: absolute;
      left: 306px;
      top: 656px;
      width: 322px;
      height: 99px;
      background: rgba(44, 62, 80, 0.8);
      border-radius: 8px;
      padding: 12px;
      overflow-y: auto;
      border: 2px solid #4a6174;
    }
    
    .queue-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #3498db;
      text-align: center;
    }
    
    .job-preview {
      background: rgba(52, 73, 94, 0.4);
      border-radius: 4px;
      padding: 6px 8px;
      margin-bottom: 4px;
      font-size: 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .job-preview.processing {
      border-left: 3px solid #f39c12;
      background: rgba(243, 156, 18, 0.1);
    }
    
    .job-company {
      font-weight: 600;
      color: #3498db;
    }
    
    .job-sushi {
      font-size: 1rem;
    }
    
    /* Stats Panel - Position: (639, 655), Size: 151 x 103 */
    .stats-panel {
      position: absolute;
      left: 639px;
      top: 655px;
      width: 151px;
      height: 103px;
      background: rgba(44, 62, 80, 0.8);
      border-radius: 8px;
      padding: 12px;
      border: 2px solid #4a6174;
    }
    
    .stats-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #3498db;
      text-align: center;
    }
    
    .metric-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      font-size: 0.75rem;
    }
    
    .metric-value {
      font-weight: 600;
      color: #e67e22;
    }
    
    /* Toast Notifications */
    .toast {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #2c3e50, #34495e);
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      animation: slideInFromTop 0.4s ease-out;
      z-index: 1000;
      font-size: 0.9rem;
    }
    
    @keyframes slideInFromTop {
      from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }
    
    /* Loading States */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 500;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .header-bar { 
        left: 10px; 
        top: 10px; 
        width: calc(100vw - 20px); 
        height: 50px; 
        font-size: 1.2rem;
      }
      
      .conveyor-belt { 
        left: 50%; 
        transform: translateX(-50%); 
        top: 80px; 
        width: 150px; 
        height: 300px; 
      }
      
      .left-label, .right-label { 
        top: 400px; 
        width: calc(50vw - 20px); 
      }
      
      .left-label { left: 10px; }
      .right-label { right: 10px; left: auto; }
      
      .left-sorting-bins, .right-sorting-bins { 
        top: 450px; 
        width: calc(50vw - 20px); 
        height: 200px; 
      }
      
      .left-sorting-bins { left: 10px; }
      .right-sorting-bins { right: 10px; left: auto; }
      
      .controls-panel, .job-queue, .stats-panel { 
        position: relative; 
        left: auto; 
        top: auto; 
        margin: 10px; 
        width: calc(100vw - 40px); 
      }
    }
    
    @media (min-width: 769px) and (max-width: 1024px) {
      .header-bar { 
        left: 50px; 
        width: calc(100vw - 100px); 
      }
      
      .conveyor-belt { 
        left: 50%; 
        transform: translateX(-50%); 
      }
      
      .left-sorting-bins { 
        left: 20px; 
      }
      
      .right-sorting-bins { 
        right: 20px; 
        left: auto; 
      }
    }
  </style>
</head>
<body>
  <!-- Header Bar -->
  <div class="header-bar">
    <h1 class="header-title">üç£ Dual Sorting Factory</h1>
    <div class="header-stats">
      <div class="stat-badge">
        <strong id="processed-count">0</strong> Processed
      </div>
      <div class="stat-badge">
        <strong id="accept-count">0</strong> Accepted
      </div>
      <div class="stat-badge">
        <strong id="reject-count">0</strong> Rejected
      </div>
    </div>
  </div>

  <!-- Conveyor Belt -->
  <div class="conveyor-belt">
    <div class="belt-container">
      <div class="belt-track" id="belt-track">
        <!-- Sushi items spawn here -->
      </div>
    </div>
  </div>

  <!-- Text Labels -->
  <div class="left-label">‚ùå REJECT ZONE</div>
  <div class="right-label">‚úÖ ACCEPT ZONE</div>

  <!-- Left Sorting Bins (Reject) -->
  <div class="left-sorting-bins">
    <div class="sorting-bin reject-bin" id="reject-bin-1">
      <div class="bin-icon">üóëÔ∏è</div>
      <div class="bin-label">NO THANKS</div>
      <div class="bin-subtitle">Not interested</div>
      <div class="bin-count" id="reject-count-1">0</div>
    </div>
    
    <div class="sorting-bin reject-bin" id="reject-bin-2">
      <div class="bin-icon">‚ùå</div>
      <div class="bin-label">HARD PASS</div>
      <div class="bin-subtitle">Definitely not</div>
      <div class="bin-count" id="reject-count-2">0</div>
    </div>
  </div>

  <!-- Right Sorting Bins (Accept) -->
  <div class="right-sorting-bins">
    <div class="sorting-bin accept-bin" id="accept-bin-1">
      <div class="bin-icon">üíØ</div>
      <div class="bin-label">INTERESTED</div>
      <div class="bin-subtitle">Worth exploring</div>
      <div class="bin-count" id="accept-count-1">0</div>
    </div>
    
    <div class="sorting-bin accept-bin" id="accept-bin-2">
      <div class="bin-icon">üéØ</div>
      <div class="bin-label">APPLY NOW</div>
      <div class="bin-subtitle">Perfect match</div>
      <div class="bin-count" id="accept-count-2">0</div>
    </div>
  </div>

  <!-- Controls Panel -->
  <div class="controls-panel">
    <div class="controls-title">‚ö° Speed</div>
    <input type="range" id="speed-slider" class="speed-slider" 
           min="0.5" max="3" step="0.5" value="1">
    <div class="speed-display" id="speed-display">Normal</div>
  </div>

  <!-- Job Queue -->
  <div class="job-queue">
    <div class="queue-title">üìã Processing Queue</div>
    <div id="job-queue-list">
      <!-- Job previews appear here -->
    </div>
  </div>

  <!-- Stats Panel -->
  <div class="stats-panel">
    <div class="stats-title">üìä Metrics</div>
    <div class="metric-row">
      <span>Speed:</span>
      <span class="metric-value" id="sorting-speed">0/min</span>
    </div>
    <div class="metric-row">
      <span>Accuracy:</span>
      <span class="metric-value" id="accuracy-rate">--</span>
    </div>
    <div class="metric-row">
      <span>Queue:</span>
      <span class="metric-value" id="queue-length">0</span>
    </div>
    <div class="metric-row">
      <span>Accept:</span>
      <span class="metric-value" id="accept-ratio">--</span>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay">
    <div>
      <div class="loading-spinner"></div>
      <div style="margin-top: 16px; text-align: center; color: white;">
        Loading sushi jobs...
      </div>
    </div>
  </div>

  <script>
    // Core Data Management
    let jobsData = [];
    let currentJobIndex = 0;
    let sortingStats = {
      processed: 0,
      accepted: 0,
      rejected: 0,
      acceptedInterested: 0,
      acceptedApply: 0,
      rejectedNotInterested: 0,
      rejectedHardPass: 0,
      startTime: Date.now()
    };
    
    // Sushi mapping
    const sushiMap = {
      'Tech': 'üç£',
      'Healthcare': 'üç±',
      'Education': 'üçô', 
      'Finance': 'üç§',
      'Marketing': 'ü•¢',
      'Sales': 'üçú',
      'default': 'üç£'
    };
    
    // Belt speed control
    let beltSpeed = 1;
    let spawnInterval = null;
    
    // Initialize the factory
    async function initDualSortingFactory() {
      console.log('üç£ Initializing Dual Sorting Factory...');
      
      await loadJobs();
      setupDragAndDrop();
      setupSpeedControl();
      startSushiSpawning();
      startMetricsUpdater();
      hideLoadingOverlay();
      
      console.log('‚úÖ Dual Sorting Factory Ready!');
    }

    // Load job data
    async function loadJobs() {
      try {
        const response = await fetch('/api/job-recommendations');
        const data = await response.json();
        jobsData = data.jobs || [];
        
        if (jobsData.length === 0) {
          showToast('‚ùå No jobs available for sorting');
          return;
        }
        
        updateJobQueue();
        showToast(`‚úÖ Loaded ${jobsData.length} jobs for dual sorting`);
        
      } catch (error) {
        console.error('Failed to load jobs:', error);
        showToast('‚ùå Failed to load jobs');
      }
    }

    // Hide loading overlay
    function hideLoadingOverlay() {
      document.getElementById('loading-overlay').style.display = 'none';
    }

    // Spawn sushi items
    function spawnSushiItem() {
      if (currentJobIndex >= jobsData.length) {
        showToast('üéâ All jobs processed! Restarting...');
        setTimeout(resetSession, 2000);
        return;
      }
      
      const job = jobsData[currentJobIndex];
      const sushiEmoji = sushiMap[job.sector] || sushiMap.default;
      
      const sushiItem = document.createElement('div');
      sushiItem.className = 'sushi-item';
      sushiItem.textContent = sushiEmoji;
      sushiItem.draggable = true;
      sushiItem.dataset.jobIndex = currentJobIndex;
      
      // Random horizontal variation
      const offset = (Math.random() - 0.5) * 15;
      sushiItem.style.left = `calc(50% + ${offset}px)`;
      sushiItem.style.animationDelay = `${Math.random() * 1}s`;
      sushiItem.style.animationDuration = `${6 / beltSpeed}s`;
      
      document.getElementById('belt-track').appendChild(sushiItem);
      setupSushiDragEvents(sushiItem);
      
      // Auto-remove after animation
      setTimeout(() => {
        if (sushiItem.parentNode) {
          sushiItem.remove();
          if (parseInt(sushiItem.dataset.jobIndex) === currentJobIndex) {
            handleJobDecision('auto-reject');
          }
        }
      }, (6000 / beltSpeed) + 1000);
      
      currentJobIndex++;
      updateJobQueue();
    }

    // Setup sushi drag events
    function setupSushiDragEvents(sushiItem) {
      sushiItem.addEventListener('dragstart', (e) => {
        sushiItem.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', sushiItem.dataset.jobIndex);
      });

      sushiItem.addEventListener('dragend', (e) => {
        sushiItem.classList.remove('dragging');
      });
    }

    // Setup drag and drop
    function setupDragAndDrop() {
      const bins = document.querySelectorAll('.sorting-bin');
      bins.forEach(bin => setupDropZone(bin));
    }

    function setupDropZone(dropZone) {
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
      });

      dropZone.addEventListener('dragleave', (e) => {
        dropZone.classList.remove('drag-over');
      });

      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        
        const jobIndex = parseInt(e.dataTransfer.getData('text/plain'));
        const sushiItem = document.querySelector(`[data-job-index="${jobIndex}"]`);
        
        if (sushiItem) {
          sushiItem.remove();
          handleJobDecision(dropZone.id);
        }
      });
    }

    // Handle job decisions
    function handleJobDecision(binId) {
      const job = jobsData[currentJobIndex - 1];
      if (!job) return;
      
      sortingStats.processed++;
      
      const binCounts = {
        'accept-bin-1': 'acceptedInterested',
        'accept-bin-2': 'acceptedApply', 
        'reject-bin-1': 'rejectedNotInterested',
        'reject-bin-2': 'rejectedHardPass'
      };
      
      if (binId === 'auto-reject') {
        sortingStats.rejected++;
        sortingStats.rejectedNotInterested++;
        showToast(`‚è∞ Auto-rejected: ${job.company}`);
        document.getElementById('reject-count-1').textContent = sortingStats.rejectedNotInterested;
      } else {
        const countKey = binCounts[binId];
        if (countKey) {
          sortingStats[countKey]++;
          
          if (binId.includes('accept')) {
            sortingStats.accepted++;
            const message = binId === 'accept-bin-2' ? 
              `üéØ APPLY NOW: ${job.company}` : 
              `üíØ Interested: ${job.company}`;
            showToast(message);
            document.getElementById(binId.replace('bin', 'count')).textContent = sortingStats[countKey];
          } else {
            sortingStats.rejected++;
            const message = binId === 'reject-bin-2' ? 
              `‚ùå Hard Pass: ${job.company}` : 
              `üóëÔ∏è Not Interested: ${job.company}`;
            showToast(message);
            document.getElementById(binId.replace('bin', 'count')).textContent = sortingStats[countKey];
          }
        }
      }
      
      updateStatsDisplay();
    }

    // Update job queue
    function updateJobQueue() {
      const queueList = document.getElementById('job-queue-list');
      queueList.innerHTML = '';
      
      const upcomingJobs = jobsData.slice(currentJobIndex, currentJobIndex + 4);
      
      upcomingJobs.forEach((job, index) => {
        const jobPreview = document.createElement('div');
        jobPreview.className = 'job-preview';
        if (index === 0) jobPreview.classList.add('processing');
        
        jobPreview.innerHTML = `
          <span class="job-company">${job.company}</span>
          <span class="job-sushi">${sushiMap[job.sector] || sushiMap.default}</span>
        `;
        
        queueList.appendChild(jobPreview);
      });
    }

    // Update statistics
    function updateStatsDisplay() {
      document.getElementById('processed-count').textContent = sortingStats.processed;
      document.getElementById('accept-count').textContent = sortingStats.accepted;
      document.getElementById('reject-count').textContent = sortingStats.rejected;
    }

    // Setup speed control
    function setupSpeedControl() {
      const speedSlider = document.getElementById('speed-slider');
      const speedDisplay = document.getElementById('speed-display');
      
      speedSlider.addEventListener('input', (e) => {
        beltSpeed = parseFloat(e.target.value);
        
        const speedLabels = {
          0.5: 'Slow',
          1.0: 'Normal', 
          1.5: 'Fast',
          2.0: 'Faster',
          2.5: 'Very Fast',
          3.0: 'Maximum'
        };
        
        speedDisplay.textContent = speedLabels[beltSpeed] || 'Custom';
        
        // Update animations
        const beltTrack = document.getElementById('belt-track');
        beltTrack.style.animationDuration = `${3 / beltSpeed}s`;
        
        // Restart spawning
        clearInterval(spawnInterval);
        startSushiSpawning();
      });
    }

    // Start spawning
    function startSushiSpawning() {
      const spawnDelay = 2500 / beltSpeed;
      
      spawnInterval = setInterval(() => {
        if (currentJobIndex < jobsData.length) {
          spawnSushiItem();
        }
      }, spawnDelay);
    }

    // Start metrics updater
    function startMetricsUpdater() {
      setInterval(() => {
        updatePerformanceMetrics();
      }, 1000);
    }

    // Update performance metrics
    function updatePerformanceMetrics() {
      const elapsed = (Date.now() - sortingStats.startTime) / 1000 / 60;
      const sortingSpeed = Math.round(sortingStats.processed / Math.max(elapsed, 0.1));
      
      const accuracyRate = sortingStats.processed > 0 ? 
        Math.round(((sortingStats.acceptedApply + sortingStats.rejectedHardPass) / sortingStats.processed) * 100) : 0;
      
      const acceptRatio = sortingStats.processed > 0 ? 
        Math.round((sortingStats.accepted / sortingStats.processed) * 100) : 0;
      
      document.getElementById('sorting-speed').textContent = `${sortingSpeed}/min`;
      document.getElementById('accuracy-rate').textContent = `${accuracyRate}%`;
      document.getElementById('accept-ratio').textContent = `${acceptRatio}%`;
      document.getElementById('queue-length').textContent = Math.max(0, jobsData.length - currentJobIndex);
    }

    // Show toast
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Reset session
    function resetSession() {
      currentJobIndex = 0;
      sortingStats = {
        processed: 0,
        accepted: 0,
        rejected: 0,
        acceptedInterested: 0,
        acceptedApply: 0,
        rejectedNotInterested: 0,
        rejectedHardPass: 0,
        startTime: Date.now()
      };
      
      document.querySelectorAll('.sushi-item').forEach(item => item.remove());
      document.querySelectorAll('.bin-count').forEach(count => count.textContent = '0');
      
      updateStatsDisplay();
      updateJobQueue();
      showToast('üîÑ New dual sorting session started');
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      switch(e.key) {
        case 'r':
        case 'R':
          e.preventDefault();
          resetSession();
          break;
      }
    });

    // Initialize on load
    document.addEventListener('DOMContentLoaded', initDualSortingFactory);
  </script>
</body>
</html>